<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Serenamente - Salud Mental Universal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#4361ee">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Register Service Worker for PWA
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=>navigator.serviceWorker.register('service-worker.js'));
    }
  </script>
  <style>
    /* Estilos básicos y modo oscuro */
    body {font-family:'Inter',sans-serif; margin:0; background:#f1f5fe; color:#222;}
    .container {max-width:900px; margin:40px auto; background:#fff; border-radius:20px; box-shadow:0 8px 32px #4361ee22; padding:40px;}
    body.dark-mode {background:#22223b; color:#f8fafc;}
    body.dark-mode .container {background:#232946;}
    .app-title {font-size:2.5rem; font-weight:700; text-align:center; margin-bottom:20px;}
    .btn {background:#4361ee;color:#fff;border:none;padding:10px 24px;border-radius:12px;font-weight:600;cursor:pointer;}
    .btn:active {background:#3a0ca3;}
    .section {margin-bottom:45px;}
    .chart-container {width:100%;max-width:700px;margin:0 auto 30px;}
    /* Más estilos personalizados aquí... */
  </style>
</head>
<body>
  <div class="container">
    <div class="app-title">Serenamente 🌿</div>
    <div class="section">
      <h2>Tu Progreso</h2>
      <div class="chart-container">
        <canvas id="progressChart"></canvas>
      </div>
    </div>
    <div class="section">
      <h2>Autoevaluación PHQ-9 (Depresión) y GAD-7 (Ansiedad)</h2>
      <button class="btn" onclick="openAssessment('phq9')">Realizar PHQ-9</button>
      <button class="btn" onclick="openAssessment('gad7')">Realizar GAD-7</button>
      <div id="assessmentContainer"></div>
    </div>
    <div class="section">
      <h2>Exportar Diario y Hábitos</h2>
      <button class="btn" onclick="exportCSV()">Exportar a CSV</button>
      <button class="btn" onclick="window.print()">Exportar a PDF</button>
    </div>
    <div class="section">
      <h2>Recordatorios y Notificaciones</h2>
      <button class="btn" onclick="scheduleNotification()">Programar recordatorio diario</button>
    </div>
    <div class="section">
      <h2>Personalización</h2>
      <label>Modo Oscuro <input type="checkbox" id="darkToggle"></label>
      <label>Perfil de usuario: 
        <select id="userProfile">
          <option value="adulto">Adulto</option>
          <option value="adolescente">Adolescente</option>
          <option value="mayor">Adulto mayor</option>
        </select>
      </label>
    </div>
    <div class="section">
      <h2>Diario Emocional</h2>
      <textarea id="journalInput" placeholder="Escribe tu entrada..." rows="2"></textarea>
      <button class="btn" onclick="saveJournal()">Guardar entrada</button>
      <div id="journalEntries"></div>
    </div>
    <div class="section">
      <h2>Hábitos Saludables</h2>
      <input id="habitInput" placeholder="Nuevo hábito...">
      <button class="btn" onclick="addHabit()">Agregar</button>
      <div id="habitList"></div>
    </div>
    <!-- Más secciones avanzadas aquí... -->
  </div>
  <script>
    // Modo oscuro persistente
    const darkToggle=document.getElementById('darkToggle');
    if(localStorage.getItem('mode')==='dark'){document.body.classList.add('dark-mode');darkToggle.checked=true;}
    darkToggle.addEventListener('change',function(){if(this.checked){document.body.classList.add('dark-mode');localStorage.setItem('mode','dark');}else{document.body.classList.remove('dark-mode');localStorage.setItem('mode','light');}});
    // Perfil de usuario personalizado
    const userProfile=document.getElementById('userProfile');
    if(localStorage.getItem('profile'))userProfile.value=localStorage.getItem('profile');
    userProfile.addEventListener('change',()=>localStorage.setItem('profile',userProfile.value));
    // Diario y hábitos
    function saveJournal(){let input=document.getElementById('journalInput');let text=input.value.trim();if(!text)return;let entries=JSON.parse(localStorage.getItem('journal')||'[]');entries.push({date:new Date().toLocaleString(),text});localStorage.setItem('journal',JSON.stringify(entries));input.value='';showJournal();drawChart();}
    function showJournal(){let entries=JSON.parse(localStorage.getItem('journal')||'[]');let html=entries.slice(-10).reverse().map(e=>`<div><b>${e.date}</b> ${e.text}</div>`).join('');document.getElementById('journalEntries').innerHTML=html||'No hay entradas.';}
    showJournal();
    function addHabit(){let input=document.getElementById('habitInput');let text=input.value.trim();if(!text)return;let habits=JSON.parse(localStorage.getItem('habits')||'[]');habits.push({text,done:false});localStorage.setItem('habits',JSON.stringify(habits));input.value='';showHabits();drawChart();}
    function toggleHabit(idx){let habits=JSON.parse(localStorage.getItem('habits')||'[]');habits[idx].done=!habits[idx].done;localStorage.setItem('habits',JSON.stringify(habits));showHabits();drawChart();}
    function showHabits(){let habits=JSON.parse(localStorage.getItem('habits')||'[]');let html=habits.map((h,i)=>`<div><input type="checkbox" ${h.done?'checked':''} onclick="toggleHabit(${i})">${h.done?'<s>'+h.text+'</s>':h.text}</div>`).join('');document.getElementById('habitList').innerHTML=html||'No hay hábitos.';}
    showHabits();
    // Chart.js progreso
    let chart;
    function drawChart(){let entries=JSON.parse(localStorage.getItem('journal')||'[]').length;let habits=JSON.parse(localStorage.getItem('habits')||'[]').filter(h=>h.done).length;let data={labels:['Entradas','Hábitos'],datasets:[{label:'Progreso',data:[entries,habits],backgroundColor:['#4361ee','#4ade80']}]};if(chart){chart.data=data;chart.update();}else{chart=new Chart(document.getElementById('progressChart'),{type:'bar',data:data,options:{scales:{y:{beginAtZero:true}}}});}
    }
    drawChart();
    // Exportar CSV
    function exportCSV(){let journals=JSON.parse(localStorage.getItem('journal')||'[]');let habits=JSON.parse(localStorage.getItem('habits')||'[]');let csv='Fecha,Entrada\n'+journals.map(e=>`${e.date},"${e.text.replace(/"/g,'""')}"`).join('\n');csv+='\n\nHábito,Completado\n'+habits.map(h=>`${h.text},${h.done?'Sí':'No'}`).join('\n');let blob=new Blob([csv],{type:'text/csv'});let url=URL.createObjectURL(blob);let a=document.createElement('a');a.href=url;a.download='serenamente.csv';a.click();URL.revokeObjectURL(url);}
    // Recordatorio diario con notificación local
    function scheduleNotification(){if('Notification'in window){Notification.requestPermission().then(function(result){if(result==='granted'){setTimeout(()=>new Notification('¡Hora de registrar tu bienestar diario!'),5000);}});}}
    // Autoevaluación PHQ-9 y GAD-7
    function openAssessment(type){
      const container=document.getElementById('assessmentContainer');container.innerHTML='';
      let questions=[],label='',max=3;
      if(type==='phq9'){label='PHQ-9 (Depresión)';questions=[
        'Poco interés o placer en hacer cosas','Sentirse deprimido, triste o sin esperanza','Dificultad para dormir o dormir demasiado','Sentirse cansado o con poca energía','Pérdida de apetito o comer en exceso','Sentirse mal consigo mismo','Dificultad para concentrarse','Moverse o hablar muy despacio o estar inquieto','Pensamientos suicidas'
      ];}
      else{label='GAD-7 (Ansiedad)';questions=[
        'Sentirse nervioso o ansioso','No poder parar de preocuparse','Preocuparse demasiado por diferentes cosas','Dificultad para relajarse','Estar inquieto','Irritable','Sentir miedo de que algo terrible pudiera pasar'
      ];}
      let html=`<h3>${label}</h3><form id="assessmentForm">`;
      questions.forEach((q,i)=>{html+=`<div>${i+1}. ${q}<br>
        <select name="q${i}">
          <option value="0">Nunca</option>
          <option value="1">Algunos días</option>
          <option value="2">Más de la mitad de los días</option>
          <option value="3">Casi todos los días</option>
        </select></div>`;});
      html+=`<button class="btn" type="submit">Interpretar</button></form><div id="assessmentResult"></div>`;
      container.innerHTML=html;
      document.getElementById('assessmentForm').onsubmit=function(e){
        e.preventDefault();
        let score=0;
        for(let i=0;i<questions.length;i++){score+=parseInt(this['q'+i].value);}
        let result='';if(type==='phq9'){
          if(score<5)result='Depresión mínima';else if(score<10)result='Depresión leve';else if(score<15)result='Moderada';else if(score<20)result='Moderadamente severa';else result='Severa';
        }else{
          if(score<5)result='Ansiedad mínima';else if(score<10)result='Leve';else if(score<15)result='Moderada';else result='Severa';
        }
        document.getElementById('assessmentResult').innerHTML=`<b>Puntaje: ${score}</b><br><b>Interpretación: ${result}</b>`;
      }
    }
  </script>
</body>
</html>
